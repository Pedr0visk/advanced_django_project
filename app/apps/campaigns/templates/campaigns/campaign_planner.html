{% extends 'base.html' %}
{% load static %}

{% block extra_menu %}
{% include 'common/bop_menu.html' with bop=campaign.bop %}
{% endblock %}

{% block main %}

{% if not campaign.created %}
<div class="alert-danger py-3 text-center mt-1">
  <p>You are in planner mode, to start the campaign please, compare the schemas, select one to default and click on
    the button "Save Changes".</p>
</div>
{% else %}
<div class="alert alert-warning alert-dismissible fade show mt-1" role="alert">
  <strong>Warning!</strong> You should be careful in editing this page, whatever changes made in this
  page can modify the <strong>campaign status</strong>, may you will can not undone this changes later on.
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endif %}


{% include 'snippets/form_snippet.html' with messages=messages %}

<!-- section 2 -->
<div class="section">
  <div class="container-fluid px-5">
    <!-- section title -->
    <div class="section-title mb-3">
      <div class="d-flex flex-column">
        {% if campaign.active %}
        <a href="{% url 'campaigns:index' campaign.pk %}" class="mb-3">
          <i class="fa fa-arrow-left"></i> back to campaign dashboard
        </a>
        {% else %}
        <a href="{% url 'bops:index' campaign.bop.pk %}" class="mb-3">
          <i class="fa fa-arrow-left"></i> back to bop
        </a>
        {% endif %}

        <h2>Campaign Planner</h2>
        <p>Bop name: <b>{{ campaign.bop }}</b> > Campaign name: <b>{{ campaign }}</b></p>
      </div>
      <div>
        <a href="{% url 'campaigns:compare' campaign.pk %}" id="toggleLoading" class="btn btn-sm btn-primary mr-2">
          <small>COMPARE <i class="fa fa-check"></i></small>
        </a>
        <a href="{% url 'campaigns:update' campaign.pk %}" class="btn btn-sm btn-primary mr-2">
          <small>EDIT
            <i class="fa fa-pencil-alt"></i></small>
        </a>
        <a href="{% url 'campaigns:delete' campaign.pk %}" class="btn btn-sm btn-primary"><small>DELETE <i
            class="fa fa-times"></i></small>
        </a>
      </div>
    </div>
    <hr>

    <!-- section content -->
    <div class="row">
      <div class="col-sm-4 col-12">
        <div class="results">
          <div class="d-flex  px-1">
            <h4 class="title-1 mr-auto">Schemas</h4>
            <a href="{% url 'campaigns:create_schema' campaign.pk %}" class="">add schema <i class="fa fa-plus
                text-success"></i></a>
          </div>

          <table class="table dnv-table m-0">
            <thead class="bg-white-50">
            <tr>
              <th scope="col">name</th>
              <th></th>
              <th></th>
              <th>See Graphs</th>
            </tr>
            </thead>
            <tbody>
            {% for schema in campaign.schemas.all %}
            <tr>
              <td>
                <a href="{% url 'campaigns:update_schema' schema.pk %}">{{ schema.name }}</a>
              </td>
              <td>
                {% if schema.is_default %}
                <small><b>DEFAULT</b></small>
                {% endif %}
              </td>
              <td width="10%">
                <a href="{% url 'campaigns:delete_schema' schema.pk %}"><i class="fa fa-times text-danger"></i></a>
              </td>
              <td width="30%">
                <a href="{% url 'campaigns:schema_run' schema.pk %}">Click here</a>
              </td>
            </tr>
            {% endfor %}
            </tbody>
          </table>

        </div>
      </div>

      <div class="col-sm-3">
        <div class="info">
          <h4>Info</h4>
          <ul class="info-list">
            <li>name: <b>{{ campaign.name }}</b></li>
            <li>base schema: <b>{{ campaign.schema_active.name }}</b></li>
            <li>BOP name: <b>{{ campaign.bop.name }}</b></li>
            <li>
              status:
              {% if campaign.active %}
              <b>Active</b> <img src="{% static 'img/icon-yes.svg' %}" alt="">
              {% else %}
              <b>Inactive</b> <img src="{% static 'img/icon-no.svg' %}" alt="">
              {% endif %}
            </li>
            <li>start date: <b>{{ campaign.start_date|date:"Y-m-d" }}</b></li>
            <li>end date: <b>{{ campaign.end_date|date:"Y-m-d" }}</b></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="modalLoading">
  <img src="{% static 'img/loading.gif' %}" width="30" alt="">
  <p>Calculating...</p>
</div>

{% endblock %}

{% block scripts %}
<script type="application/javascript">
    const btn = document.getElementById("toggleLoading");
    const modal = document.getElementById("modalLoading");

    btn.addEventListener('click', function () {
        modal.style.display = "flex";
    });

</script>
{% endblock %}
