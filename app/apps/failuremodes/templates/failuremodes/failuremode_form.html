{% extends 'base.html' %}
{% load static %}

{% block main %}

<div class="section bg-white">
  <div class="container-fluid px-5">
    <div class="section-title mb-4 d-flex">
      <p clas>Change Failure Mode</p>
    </div>
    <div class="row">
      <div class="col-sm-12">
       <form method="post">
          {% csrf_token %}
          <table class="table-form">
            {{ form.as_table }}
            <tr>
              <td></td>
              <td><button type="submit" class="btn-standard">Save</button></td>
            </tr>
          </table>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById("fmForm").onsubmit = function (e) {
        e.preventDefault();

        const request = new XMLHttpRequest();
        let formData = new FormData();
        let distribution = {};

        formData.append('csrfmiddlewaretoken', this.csrfmiddlewaretoken.value)
        formData.append('name', this.name.value)
        formData.append('component', this.component.value)
        formData.append('diagnostic_coverage', this.diagnostic_coverage.value)

        let type = this.type.value
        distribution.type = type

        switch (type) {
            case 'Probability':
                distribution.probability = this.probability.value
                break;
            case 'Exponential':
                distribution.exponential_failure_rate = this.exponential_failure_rate.value
                break;
            case 'Step':
                distribution.cycle = {}
                distribution.cycle.limit = this.cycle_limit.value
                distribution.cycle.size = this.cycle_size.value
                distribution.cycle.value = this.cycle_value.value
                distribution.initial_failure_rate = this.initial_failure_rate.value
                break;
            case 'Weibull':
                distribution.form = this.form.value;
                distribution.scale = this.scale.value;
                break;
            default:
                break;
        }

        formData.append('distribution', JSON.stringify(distribution))

        request.open("post", "{{ request.path }}")
        request.send(formData)

        request.onreadystatechange = function () {
            console.log(this.response)
            let res = JSON.parse(this.response)
            if (this.readyState == 4 && this.status == 200) {
                let messageList = document.getElementById("messageList")
                messageList.innerHTML = `<li class='success'>${res.message}</li>`
                window.scrollTo(0, 0);
            }
        };

    }


    // Query all input fields
    var form_fields = document.getElementsByTagName('input')
    // customization of form fields
    for (var field in form_fields) {
        if (form_fields[field].type == 'file') continue
        form_fields[field].className += 'form-control form-control-sm'
    }

    // Query all selects fields
    var form_fields = document.getElementsByTagName('select')
    // customization of form fields
    for (var field in form_fields) {
        form_fields[field].className += 'form-control form-control-sm'
    }
</script>
{% endblock %}
